<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Instagram Reels - Final Ultimate</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Grand+Hotel&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* --- 1. RESET & GLOBAL --- */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            background-color: #000; color: white; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            height: 100vh; height: 100dvh; width: 100vw; 
            overflow: hidden; display: grid; place-items: center; 
        }

        /* --- 2. LOGIN SCREEN --- */
        #loginScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #000; display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 9999; padding: 20px; text-align: center;
        }
        #loginScreen h2 { font-family: 'Grand Hotel', cursive; font-size: 36px; margin-bottom: 30px; letter-spacing: 1px; color: white; }
        .input-group { margin-bottom: 15px; width: 100%; max-width: 300px; text-align: left; }
        .input-group label { font-size: 13px; color: #8e8e8e; margin-bottom: 8px; display: block; }
        .input-group input { 
            width: 100%; padding: 14px; border-radius: 6px; border: 1px solid #363636; 
            background: #121212; color: white; font-size: 14px; outline: none; transition: border 0.2s;
        }
        .input-group input:focus { border-color: #555; }
        .login-btn { 
            background: #0095f6; color: white; border: none; padding: 12px 0; width: 100%; max-width: 300px;
            border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; margin-top: 15px; 
        }
        .hint-text { color: #ed4956; font-size: 12px; margin-top: 8px; display: none; }
        .error-shake { animation: shake 0.4s ease-in-out; border-color: #ed4956 !important; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* --- 3. APP CONTAINER --- */
        .app__phone {
            position: relative; height: 100%; width: 100%; max-width: 450px;
            background-color: black; overflow: hidden; margin: 0 auto;
            opacity: 0; transition: opacity 0.8s ease;
        }
        @media (max-width: 500px) { .app__phone { max-width: 100%; } }
        .app__phone.unlocked { opacity: 1; }

        /* HEADER */
        .app__header { 
            position: absolute; top: 0; left: 0; width: 100%; padding: 20px 15px;
            z-index: 100; pointer-events: none;
            background: linear-gradient(to bottom, rgba(0,0,0,0.4), transparent);
            display: flex; justify-content: space-between; align-items: center;
            transition: opacity 0.2s;
        }
        .app__header h1 { font-family: 'Grand Hotel', cursive; font-size: 28px; font-weight: 400; letter-spacing: 1px; }
        .camera-icon { width: 24px; height: 24px; fill: white; }

        /* VIDEO CONTAINER */
        .app__videos { 
            height: 100%; width: 100%; overflow-y: scroll; 
            scroll-snap-type: y mandatory; scrollbar-width: none; 
            scroll-behavior: smooth; 
        }
        .app__videos::-webkit-scrollbar { display: none; }
        
        .video { 
            position: relative; height: 100%; width: 100%; 
            background-color: #121212; scroll-snap-align: start; scroll-snap-stop: always; 
        }
        .video__player { width: 100%; height: 100%; object-fit: cover; }
        
        .video-overlay-gradient {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 35%;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            pointer-events: none; z-index: 10;
        }

        /* LOADERS & INDICATORS */
        .video-loader { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 30px; height: 30px; border: 3px solid rgba(255,255,255,0.3); 
            border-top: 3px solid white; border-radius: 50%; 
            animation: spin 0.8s linear infinite; z-index: 5; display: none; 
        }
        .video.loading .video-loader { display: block; }
        @keyframes spin { 100% { transform: translate(-50%, -50%) rotate(360deg); } }
        
        .volume-indicator { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 70px; height: 70px; background: rgba(0, 0, 0, 0.6); 
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.2s ease; pointer-events: none; z-index: 200;
            backdrop-filter: blur(2px);
        }
        .volume-indicator svg { width: 32px; height: 32px; fill: white; }

        .speed-indicator {
            position: absolute; top: 12%; left: 50%; transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8); color: white;
            padding: 8px 16px; border-radius: 20px;
            font-size: 14px; font-weight: 600;
            opacity: 0; pointer-events: none; transition: opacity 0.2s ease;
            z-index: 150; backdrop-filter: blur(4px);
            display: flex; align-items: center; gap: 5px;
        }

        .reel-progress-bg {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 3px;
            background: rgba(255, 255, 255, 0.3); z-index: 80; pointer-events: auto;
        }
        .reel-progress-fill {
            height: 100%; width: 0%; background: white; transition: width 0.1s linear;
        }

        /* --- HEART ANIMATION --- */
        .big-love-container {
            position: absolute; top: 50%; left: 50%; 
            transform: translate(-50%, -50%); width: 120px; height: 120px;
            pointer-events: none; z-index: 50;
        }
        .pop-heart {
            width: 100%; height: 100%;
            animation: instagramPop 1000ms cubic-bezier(0.2, 0.8, 0.2, 1.2) forwards;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3));
        }
        @keyframes instagramPop {
            0% { transform: scale(0) rotate(-15deg); opacity: 0; }
            15% { transform: scale(1.2) rotate(5deg); opacity: 1; }
            30% { transform: scale(0.9) rotate(-3deg); }
            45% { transform: scale(1) rotate(0deg); }
            80% { transform: scale(1) opacity(1); }
            100% { transform: scale(0) opacity(0); }
        }

        /* --- UI ELEMENTS --- */
        .videoFooter { 
            position: absolute; bottom: 10px; left: 12px; 
            color: white; width: calc(100% - 70px); z-index: 30; padding-bottom: 10px;
            transition: opacity 0.2s;
        }
        .user-row { display: flex; align-items: center; margin-bottom: 8px; }
        
        .shared-avatar {
            width: 32px; height: 32px; border-radius: 50%; margin-right: 10px; 
            object-fit: cover; cursor: pointer; border: 1.5px solid rgba(255, 255, 255, 0.2);
        }
        .user-avatar-small { border-color: white; }
        
        .username { font-size: 14px; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.5); margin-right: 8px; }
        
        /* Rounded Pill Box Button */
        .follow-btn { 
            background: transparent; border: 1px solid white; color: white; 
            border-radius: 8px; padding: 4px 14px; font-size: 13px; font-weight: 600; 
            cursor: pointer; backdrop-filter: blur(4px); transition: all 0.2s;
        }
        .follow-btn.following { 
            border-color: rgba(255,255,255,0.5); opacity: 0.8; background: rgba(255,255,255,0.15); 
        }

        .description { font-size: 14px; font-weight: 400; line-height: 1.3; margin-bottom: 10px; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
        .more-btn { color: #aaa; cursor: pointer; }
        .music-row { display: flex; align-items: center; font-size: 13px; font-weight: 500; }
        .music-icon { margin-right: 8px; fill: white; width: 12px; height: 12px; }
        .marquee-container { 
            overflow: hidden; white-space: nowrap; width: 150px; 
            mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
            -webkit-mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
        }
        .marquee-text { display: inline-block; animation: scrollText 6s linear infinite; padding-left: 100%; }
        @keyframes scrollText { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        .videoSidebar { 
            position: absolute; bottom: 20px; right: 0; width: 60px;
            display: flex; flex-direction: column; align-items: center; 
            gap: 20px; z-index: 30; padding-bottom: 10px;
            transition: opacity 0.2s;
        }
        .sidebar-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .sidebar-icon { width: 28px; height: 28px; fill: white; filter: drop-shadow(0 2px 5px rgba(0,0,0,0.3)); transition: transform 0.1s; }
        .sidebar-text { font-size: 13px; font-weight: 500; margin-top: 5px; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
        .sidebar-item:active .sidebar-icon { transform: scale(0.9); }
        .like-btn.liked .sidebar-icon { fill: #ff3040; stroke: none; animation: likeBounce 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes likeBounce { 0% { transform: scale(1); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }
        
        .music-disc-container { 
            width: 38px; height: 38px; border-radius: 6px; 
            border: 2px solid white; overflow: hidden; margin-top: 10px;
            display: flex; justify-content: center; align-items: center; background: #222;
        }
        .music-disc { width: 100%; height: 100%; object-fit: cover; border-radius: 4px; cursor: pointer; }

        /* --- SHEETS & SWIPE --- */
        .sheet-overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.5); z-index: 2000; display: none; opacity: 0; transition: opacity 0.2s;
        }
        .sheet-overlay.active { display: block; opacity: 1; }
        .bottom-sheet { 
            position: absolute; bottom: -100%; left: 0; width: 100%; 
            background-color: #1a1a1a; border-radius: 12px 12px 0 0; 
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); 
            display: flex; flex-direction: column; height: 70%; border-top: 1px solid #333;
            transform: translateY(100%);
        }
        .sheet-overlay.active .bottom-sheet { bottom: 0; transform: translateY(0); }
        .sheet-handle-area { width: 100%; padding: 10px; cursor: grab; display: flex; justify-content: center; }
        .sheet-handle { width: 40px; height: 4px; background: #555; border-radius: 2px; }
        .sheet-header { text-align: center; font-weight: 600; font-size: 14px; padding-bottom: 10px; border-bottom: 1px solid #333; }
        .comments-list { flex: 1; overflow-y: auto; padding: 15px; }
        
        /* TOAST */
        #customToast {
            position: fixed; top: -60px; left: 50%; transform: translateX(-50%);
            background-color: #262626; color: white; padding: 14px 24px;
            border-radius: 8px; font-size: 14px; font-weight: 500;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); z-index: 9999;
            transition: top 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; align-items: center; gap: 10px; border: 1px solid #333;
        }
        #customToast.show { top: 20px; }
        
        /* Comments UI */
        .comment-input-box { 
            display: flex; align-items: center; padding: 10px 15px; 
            border-top: 1px solid #333; background: #1a1a1a; margin-bottom: env(safe-area-inset-bottom);
        }
        .comment-input { flex: 1; background: transparent; border: none; color: white; outline: none; font-size: 14px; }
        .post-link { color: #0095f6; font-weight: 600; font-size: 14px; margin-left: 10px; cursor: pointer; opacity: 0.5; pointer-events: none; }
        .post-link.active { opacity: 1; pointer-events: auto; }
        .comment-row { display: flex; margin-bottom: 15px; font-size: 13px; }
        .c-content { flex: 1; }
        .c-user { font-weight: 600; margin-right: 5px; color: #f5f5f5; }
        .c-text { color: #eee; }
        .c-meta { color: #888; font-size: 11px; margin-top: 4px; display: flex; gap: 10px; }
        .c-like { padding: 5px; cursor: pointer; }
        .c-heart { width: 12px; height: 12px; fill: none; stroke: #888; stroke-width: 2; }
        .c-like.liked .c-heart { fill: #ff3040; stroke: #ff3040; }
        
        /* Share UI */
        .share-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; padding: 20px; text-align: center; }
        .share-btn { display: flex; flex-direction: column; align-items: center; font-size: 11px; color: #ccc; gap: 8px; cursor: pointer; }
        .share-circle { width: 48px; height: 48px; border-radius: 50%; border: 1px solid #333; display: flex; justify-content: center; align-items: center; font-size: 20px; background: #000; transition: background 0.2s; }
        .share-btn:active .share-circle { background: #222; }

        /* --- ZOOM OVERLAY --- */
        #zoomOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); 
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            z-index: 10000; display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
        }
        #zoomOverlay.active { opacity: 1; pointer-events: auto; }
        #zoomedImg {
            width: 300px; height: 300px; border-radius: 50%; object-fit: cover;
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transform: scale(0.5); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #zoomOverlay.active #zoomedImg { transform: scale(1); }

    </style>
</head>
<body>

    <div id="customToast">
        <span style="font-size:18px">üîó</span> Link copied to clipboard
    </div>

    <div id="loginScreen">
        <h2>Security Check</h2>
        <div class="input-group">
            <label>Tera, Jaiuu ka dia hua naam</label>
            <input type="text" id="pass1" placeholder="Type answer..." autocomplete="off">
            <p class="hint-text" id="hint1">Hint: üòã</p>
        </div>
        <div class="input-group">
            <label>Tune, Jaiuu ko dia hua naam</label>
            <input type="text" id="pass2" placeholder="Type answer..." autocomplete="off">
            <p class="hint-text" id="hint2">Hint: ü¶á</p>
        </div>
        <button class="login-btn" onclick="checkLogin()">Log In</button>
    </div>

    <div class="app__phone" id="mainApp">
        <div class="app__header">
            <h1>Reels</h1>
            <svg class="camera-icon" viewBox="0 0 24 24"><path d="M20 4h-3.17L15 2H9L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 11.5V13H9v2.5L5.5 12 9 8.5V11h6V8.5l3.5 3.5-3.5 3.5z"/></svg>
        </div>

        <div class="app__videos" id="videoContainer"></div>

        <div class="sheet-overlay" id="commentsWrapper" onclick="closeSheet('commentsWrapper')">
            <div class="bottom-sheet" id="commentsSheet" onclick="event.stopPropagation()">
                <div class="sheet-handle-area"><div class="sheet-handle"></div></div>
                <div class="sheet-header">Comments</div>
                <div class="comments-list" id="commentsList"></div>
                <div class="comment-input-box">
                    <img src="https://i.pravatar.cc/150?img=68" class="shared-avatar" alt="Me" onclick="zoomProfile(event, this.src)">
                    <input type="text" class="comment-input" id="commentInput" placeholder="Add a comment..." oninput="togglePostBtn(this)">
                    <div class="post-link" id="postBtn" onclick="postComment()">Post</div>
                </div>
            </div>
        </div>

        <div class="sheet-overlay" id="shareWrapper" onclick="closeSheet('shareWrapper')">
            <div class="bottom-sheet" id="shareSheet" style="height: auto; padding-bottom: 20px;" onclick="event.stopPropagation()">
                <div class="sheet-handle-area"><div class="sheet-handle"></div></div>
                <div class="sheet-header" style="border:none; text-align: left; padding-left: 20px;">Share to...</div>
                <div class="share-grid">
                    <div class="share-btn" onclick="shareAction('link')">
                        <div class="share-circle">üîó</div><span>Copy Link</span>
                    </div>
                    <div class="share-btn" onclick="shareAction('whatsapp')">
                        <div class="share-circle" style="border-color:#25D366; color:#25D366">üí¨</div><span>WhatsApp</span>
                    </div>
                    <div class="share-btn" onclick="shareAction('telegram')">
                        <div class="share-circle" style="border-color:#0088cc; color:#0088cc">‚úàÔ∏è</div><span>Telegram</span>
                    </div>
                    <div class="share-btn" onclick="window.location.reload()">
                        <div class="share-circle">‚Üª</div><span>Reload</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="zoomOverlay">
        <img src="" id="zoomedImg" alt="Profile">
    </div>

    <script>
        const LOGIN_ANSWERS = { a: "boondikaladdu", b: "chamkadad" };
        
        // REPLACE WITH YOUR REAL VIDEO URLS
        const REELS_DATA = [
            {
                id: 1, src: "video1.mp4", user: "neon_vibes", avatar: "https://i.pravatar.cc/150?img=1", 
                desc: "Wait for the drop! üò± #vibes #nightlife", likes: 12400, comments: 45, song: "Original Audio", isFollowing: false,
                commentData: [{ user: "alex_r", text: "Insane! üî•", avatar: "https://i.pravatar.cc/150?img=3", liked: false }]
            },
            {
                id: 2, src: "video2.mp4", user: "travel_diaries", avatar: "https://i.pravatar.cc/150?img=8", 
                desc: "Morning views. ‚òïÔ∏è", likes: 850, comments: 12, song: "LoFi Beats", isFollowing: true, commentData: []
            },
            {
                id: 3, src: "video3.mp4", user: "gym_rat", avatar: "https://i.pravatar.cc/150?img=12", 
                desc: "No pain no gain. üí™", likes: 3200, comments: 88, song: "Phonk Walker", isFollowing: false, commentData: []
            },
            {
                id: 4, src: "video4.mp4", user: "tech_guru", avatar: "https://i.pravatar.cc/150?img=15", 
                desc: "Testing preloader... üöÄ", likes: 500, comments: 5, song: "Future Tech", isFollowing: false, commentData: []
            }
        ];

        const ICONS = {
            heartOutline: `<svg class="sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`,
            heartFilled: `<svg class="sidebar-icon" viewBox="0 0 24 24" fill="#ff3040" stroke="none"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`,
            comment: `<svg class="sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>`,
            share: `<svg class="sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>`,
            more: `<svg class="sidebar-icon" viewBox="0 0 24 24" fill="white"><circle cx="12" cy="12" r="2"/><circle cx="12" cy="5" r="2"/><circle cx="12" cy="19" r="2"/></svg>`,
            music: `<svg class="music-icon" viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>`,
            volumeOn: `<svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>`,
            volumeOff: `<svg viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg>`
        };

        const GRADIENT_PAIRS = [
            ['#FF0080', '#FF8C00'], ['#00C9FF', '#92FE9D'], ['#FC466B', '#3F5EFB'], 
            ['#8E2DE2', '#4A00E0'], ['#f12711', '#f5af19'], ['#00F260', '#0575E6']
        ];

        /* ==================== SETUP UI ==================== */
        const container = document.getElementById('videoContainer');
        let currentVideoIndex = 0;
        let globalMuted = true;

        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num;
        }

        REELS_DATA.forEach((reel, index) => {
            const shortDesc = reel.desc.length > 60 ? reel.desc.substring(0, 60) + '...' : reel.desc;
            const hasMore = reel.desc.length > 60;
            const followText = reel.isFollowing ? "Following" : "Follow";
            const followClass = reel.isFollowing ? "following" : "";

            const html = `
            <div class="video loading" id="reel-${index}">
                <video class="video__player" loop muted playsinline preload="none"></video>
                <div class="video-loader"></div>
                <div class="video-overlay-gradient"></div>
                <div class="heart-animation-layer" style="position: absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:50;"></div>
                <div class="volume-indicator">${ICONS.volumeOff}</div>
                <div class="speed-indicator">2x Speed &raquo;</div>
                <div class="reel-progress-bg"><div class="reel-progress-fill"></div></div>

                <div class="videoFooter">
                    <div class="user-row">
                        <img src="${reel.avatar}" class="shared-avatar user-avatar-small" onclick="zoomProfile(event, this.src)">
                        <span class="username">${reel.user}</span>
                        <button class="follow-btn ${followClass}" onclick="toggleFollow(this, event)">${followText}</button>
                    </div>
                    <div class="description">
                        <span class="desc-text">${shortDesc}</span>
                        ${hasMore ? `<span class="more-btn" onclick="readMore(this, '${reel.desc.replace(/'/g, "\\'")}')"> more</span>` : ''}
                    </div>
                    <div class="music-row">
                        ${ICONS.music}
                        <div class="marquee-container"><span class="marquee-text">${reel.song}</span></div>
                    </div>
                </div>

                <div class="videoSidebar">
                    <div class="sidebar-item like-btn" onclick="toggleLike(this, event)">
                        ${ICONS.heartOutline}<span class="sidebar-text">${formatNumber(reel.likes)}</span>
                    </div>
                    <div class="sidebar-item" onclick="openComments(${index})">
                        ${ICONS.comment}<span class="sidebar-text">${formatNumber(reel.comments)}</span>
                    </div>
                    <div class="sidebar-item" onclick="openShare()">
                        ${ICONS.share}<span class="sidebar-text">Share</span>
                    </div>
                    <div class="sidebar-item">${ICONS.more}</div>
                    <div class="music-disc-container"><img src="${reel.avatar}" class="music-disc" onclick="zoomProfile(event, this.src)"></div>
                </div>
            </div>`;
            container.innerHTML += html;
        });

        /* ==================== SMART PRELOADER ==================== */
        const blobCache = {};
        async function preloadVideo(index) {
            if (index < 0 || index >= REELS_DATA.length) return;
            if (blobCache[index]) return;
            try {
                const response = await fetch(REELS_DATA[index].src);
                const blob = await response.blob();
                const blobUrl = URL.createObjectURL(blob);
                blobCache[index] = blobUrl;
                const vidEl = document.getElementById(`reel-${index}`).querySelector('video');
                if (vidEl && !vidEl.src) vidEl.src = blobUrl;
            } catch (err) { console.error("Err", err); }
        }

        const videos = document.querySelectorAll('video');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const vid = entry.target;
                const wrapper = vid.parentElement;
                const index = parseInt(wrapper.id.replace('reel-', ''));

                if (entry.isIntersecting) {
                    currentVideoIndex = index;
                    if (blobCache[index]) { if(vid.src !== blobCache[index]) vid.src = blobCache[index]; } 
                    else { vid.src = REELS_DATA[index].src; }
                    
                    vid.muted = globalMuted;
                    const playPromise = vid.play();
                    if(playPromise !== undefined) playPromise.then(() => wrapper.classList.remove('loading')).catch(e=>{});

                    preloadVideo(index + 1);
                    preloadVideo(index + 2);

                    Object.keys(blobCache).forEach(key => {
                        const i = parseInt(key);
                        if (i < index - 1 || i > index + 3) {
                            URL.revokeObjectURL(blobCache[i]); delete blobCache[i];
                            const oldVid = document.getElementById(`reel-${i}`)?.querySelector('video');
                            if(oldVid) { oldVid.src = ""; oldVid.load(); }
                        }
                    });
                } else {
                    vid.pause();
                }
            });
        }, { threshold: 0.6 });
        
        videos.forEach(v => {
            observer.observe(v);
            v.addEventListener('timeupdate', () => {
                const duration = v.duration;
                if(duration > 0) {
                    const percent = (v.currentTime / duration) * 100;
                    const bar = v.parentElement.querySelector('.reel-progress-fill');
                    if(bar) bar.style.width = percent + '%';
                }
            });
        });
        /* ==================== REEL PROGRESS SEEK ==================== */
document.querySelectorAll('.reel-progress-bg').forEach(progressBg => {
    const videoWrapper = progressBg.closest('.video');
    const video = videoWrapper.querySelector('.video__player');
    const fill = progressBg.querySelector('.reel-progress-fill');

    function seekTo(clientX) {
        if (!video.duration) return;

        const rect = progressBg.getBoundingClientRect();
        let percent = (clientX - rect.left) / rect.width;
        percent = Math.max(0, Math.min(1, percent));

        video.currentTime = percent * video.duration;
        fill.style.width = (percent * 100) + '%';
    }

    // Click (desktop)
    progressBg.addEventListener('click', e => {
        e.stopPropagation();
        seekTo(e.clientX);
    });

    // Touch (mobile)
    progressBg.addEventListener('touchstart', e => {
        e.stopPropagation();
        seekTo(e.touches[0].clientX);
    });

    progressBg.addEventListener('touchmove', e => {
        e.stopPropagation();
        seekTo(e.touches[0].clientX);
    });
});

        /* ==================== INTERACTION LOGIC ==================== */
        const zoomOverlay = document.getElementById('zoomOverlay');
        const zoomedImg = document.getElementById('zoomedImg');
        window.zoomProfile = function(e, src) {
            e.stopPropagation(); zoomedImg.src = src; zoomOverlay.classList.add('active');
        };
        zoomOverlay.addEventListener('click', () => zoomOverlay.classList.remove('active'));

        // Swipe & Sheet Logic
        let startY = 0, currentSheet = null;
        function initSwipeListeners(sheetId) {
            const sheet = document.getElementById(sheetId);
            const handleArea = sheet.querySelector('.sheet-handle-area');
            handleArea.addEventListener('touchstart', (e) => { startY = e.touches[0].clientY; currentSheet = sheet; sheet.style.transition = 'none'; });
            handleArea.addEventListener('touchmove', (e) => {
                if (!currentSheet) return;
                const diff = e.touches[0].clientY - startY;
                if (diff > 0) { e.preventDefault(); currentSheet.style.transform = `translateY(${diff}px)`; }
            });
            handleArea.addEventListener('touchend', (e) => {
                if (!currentSheet) return;
                const diff = e.changedTouches[0].clientY - startY;
                currentSheet.style.transition = 'transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)';
                if (diff > 100) closeSheet(currentSheet.parentElement.id);
                else currentSheet.style.transform = '';
                currentSheet = null;
            });
        }
        initSwipeListeners('commentsSheet');
        initSwipeListeners('shareSheet');

        document.querySelectorAll('.video').forEach(wrapper => {
            let lastClick = 0, longPressTimer;
            const video = wrapper.querySelector('video');
            const volInd = wrapper.querySelector('.volume-indicator');
            const speedInd = wrapper.querySelector('.speed-indicator');

            wrapper.addEventListener('click', (e) => {
                if(e.target.closest('.videoFooter') || e.target.closest('.videoSidebar')) return;
                const now = new Date().getTime();
                if (now - lastClick < 300) { handleDoubleTap(wrapper); lastClick = 0; } 
                else { lastClick = now; setTimeout(() => { if (now === lastClick) toggleMute(video, volInd); }, 300); }
            });

            const startPress = (e) => {
                if(e.target.closest('.videoFooter') || e.target.closest('.videoSidebar') || document.querySelector('.sheet-overlay.active')) return;
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const isSide = clientX < window.innerWidth * 0.3 || clientX > window.innerWidth * 0.7;
                longPressTimer = setTimeout(() => {
                    if (isSide) { video.playbackRate = 2.0; speedInd.style.opacity = 1; } 
                    else { video.pause(); wrapper.querySelector('.videoFooter').style.opacity = 0; wrapper.querySelector('.videoSidebar').style.opacity = 0; document.querySelector('.app__header').style.opacity = 0; }
                }, 400);
            };

            const endPress = () => {
                clearTimeout(longPressTimer);
                video.playbackRate = 1.0; speedInd.style.opacity = 0;
                if(wrapper.querySelector('.videoFooter').style.opacity === '0') {
                    if(video.paused && !document.hidden) video.play();
                    wrapper.querySelector('.videoFooter').style.opacity = 1; wrapper.querySelector('.videoSidebar').style.opacity = 1; document.querySelector('.app__header').style.opacity = 1;
                }
            };
            wrapper.addEventListener('touchstart', startPress); wrapper.addEventListener('touchend', endPress);
            wrapper.addEventListener('mousedown', startPress); wrapper.addEventListener('mouseup', endPress);
            wrapper.addEventListener('mouseleave', endPress);
        });

        // Helpers
        function toggleMute(vid, indicator) {
            globalMuted = !globalMuted;
            document.querySelectorAll('video').forEach(v => v.muted = globalMuted);
            indicator.innerHTML = globalMuted ? ICONS.volumeOff : ICONS.volumeOn;
            indicator.style.opacity = 1; setTimeout(() => indicator.style.opacity = 0, 1000);
        }
        function handleDoubleTap(wrapper) {
            const likeBtn = wrapper.querySelector('.like-btn');
            const layer = wrapper.querySelector('.heart-animation-layer');
            createGradientHeart(layer);
            if (!likeBtn.classList.contains('liked')) toggleLike(likeBtn, { stopPropagation: ()=>{} });
        }
        function createGradientHeart(layer) {
            const colors = GRADIENT_PAIRS[Math.floor(Math.random() * GRADIENT_PAIRS.length)];
            const uniqueId = 'grad-' + Math.random().toString(36).substr(2, 9);
            const heartDiv = document.createElement('div'); heartDiv.classList.add('big-love-container');
            heartDiv.innerHTML = `<svg class="pop-heart" viewBox="0 0 24 24"><defs><linearGradient id="${uniqueId}" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:${colors[0]}; stop-opacity:1" /><stop offset="100%" style="stop-color:${colors[1]}; stop-opacity:1" /></linearGradient></defs><path fill="url(#${uniqueId})" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`;
            layer.appendChild(heartDiv); setTimeout(() => heartDiv.remove(), 1000);
        }
        function toggleFollow(btn, e) { e.stopPropagation(); btn.innerText = btn.innerText === "Follow" ? "Following" : "Follow"; btn.classList.toggle('following'); }
        function readMore(btn, fullText) { btn.parentElement.innerHTML = `<span class="desc-text">${fullText}</span>`; }
        function toggleLike(btn, e) {
            e.stopPropagation(); const isLiked = btn.classList.contains('liked'); const countSpan = btn.querySelector('.sidebar-text');
            let count = parseCount(countSpan.innerText);
            if(isLiked) { btn.classList.remove('liked'); btn.innerHTML = ICONS.heartOutline + `<span class="sidebar-text">${formatNumber(count - 1)}</span>`; } 
            else { btn.classList.add('liked'); btn.innerHTML = ICONS.heartFilled + `<span class="sidebar-text">${formatNumber(count + 1)}</span>`; }
        }
        function parseCount(str) { if(str.includes('K')) return parseFloat(str) * 1000; if(str.includes('M')) return parseFloat(str) * 1000000; return parseInt(str); }
        function openComments(index) {
            currentVideoIndex = index; const data = REELS_DATA[index]; const list = document.getElementById('commentsList'); list.innerHTML = "";
            data.commentData.forEach(c => { list.innerHTML += `<div class="comment-row"><img src="${c.avatar}" class="shared-avatar" onclick="zoomProfile(event, this.src)"><div class="c-content"><div><span class="c-user">${c.user}</span><span class="c-text">${c.text}</span></div><div class="c-meta"><span>2d</span><span>Reply</span></div></div><div class="c-like ${c.liked ? 'liked' : ''}" onclick="this.classList.toggle('liked')"><svg class="c-heart" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></div></div>`; });
            document.getElementById('commentsWrapper').classList.add('active');
        }
        function togglePostBtn(input) { const btn = document.getElementById('postBtn'); if(input.value.trim().length > 0) btn.classList.add('active'); else btn.classList.remove('active'); }
        function postComment() {
            const input = document.getElementById('commentInput'); if(!input.value.trim()) return;
            REELS_DATA[currentVideoIndex].commentData.push({ user: "me", text: input.value, avatar: "https://i.pravatar.cc/150?img=68", liked: false });
            openComments(currentVideoIndex); input.value = "";
            const reel = document.getElementById(`reel-${currentVideoIndex}`); const commentCount = reel.querySelectorAll('.sidebar-text')[1];
            commentCount.innerText = formatNumber(parseCount(commentCount.innerText) + 1);
        }
        function openShare() { document.getElementById('shareWrapper').classList.add('active'); }
        function closeSheet(wrapperId) { 
            const sheet = document.getElementById(wrapperId).querySelector('.bottom-sheet');
            sheet.style.transform = 'translateY(100%)'; 
            setTimeout(() => { document.getElementById(wrapperId).classList.remove('active'); sheet.style.transform = ''; }, 300);
        }
        
        // TOAST NOTIFICATION
        function showToast(msg) {
            const toast = document.getElementById('customToast');
            toast.innerHTML = `üîó ${msg}`;
            toast.classList.add('show');
            setTimeout(() => { toast.classList.remove('show'); }, 3000);
        }

        function shareAction(type) {
            if(type === 'link') { 
                showToast('Link copied to clipboard'); 
                closeSheet('shareWrapper'); 
            }
            if(type === 'whatsapp') window.open('https://wa.me/?text=Check%20this%20reel!');
        }
        
        let attempt = 0;
        function checkLogin() {
            const p1 = document.getElementById('pass1').value.trim().toLowerCase(); const p2 = document.getElementById('pass2').value.trim().toLowerCase();
            if(p1 === LOGIN_ANSWERS.a && p2 === LOGIN_ANSWERS.b) {
                document.getElementById('loginScreen').style.display = 'none'; document.getElementById('mainApp').classList.add('unlocked');
                preloadVideo(0); // Load first video
                preloadVideo(1); // Load second video
            } else {
                attempt++; const i1 = document.getElementById('pass1'); const i2 = document.getElementById('pass2');
                i1.classList.add('error-shake'); i2.classList.add('error-shake'); setTimeout(() => { i1.classList.remove('error-shake'); i2.classList.remove('error-shake'); }, 400);
                if(attempt >= 3) { document.getElementById('hint1').style.display = 'block'; document.getElementById('hint2').style.display = 'block'; }
            }
        }
    </script>
</body>
</html>
